<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Syllabus Creator</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="styles.css" rel="stylesheet">
<style>
  body {
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 20px;
    background-color: #ffffff;
    overflow-y: scroll;
  }
  .form-wrapper {
    width: 100%;
    max-width: 800px;
  }
</style>
</head>
<body>

<div class="form-wrapper">
  <form method="post" action="post.php" id="myform" autocomplete="off" novalidate>
    <div class="row gx-5 align-items-start">
      <div class="col-md-2 mb-3">
        <div class="d-grid gap-2">
          <input type="button" id="save" class="btn btn-outline-primary" value="Save"/>
          <input type="reset" class="btn btn-outline-secondary" value="Reset"/>
        </div>
      </div>

      <div class="col-md-10">
        <ul class="nav nav-tabs mb-3 justify-content-center" id="syllabusTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="basic-tab" data-bs-toggle="tab" data-bs-target="#divbasic" type="button">Basic</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="obj-tab" data-bs-toggle="tab" data-bs-target="#divobj" type="button">Objectives</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="source-tab" data-bs-toggle="tab" data-bs-target="#divsource" type="button">Sources</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="assess-tab" data-bs-toggle="tab" data-bs-target="#divassess" type="button">Assessment</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="outcome-tab" data-bs-toggle="tab" data-bs-target="#divoutcome" type="button">Outcomes</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="contrib-tab" data-bs-toggle="tab" data-bs-target="#divcontrib" type="button">Contributions</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="ects-tab" data-bs-toggle="tab" data-bs-target="#divects" type="button">ECTS</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="contents-tab" data-bs-toggle="tab" data-bs-target="#divcontents" type="button">Contents</button>
          </li>
        </ul>

        <div class="tab-content">
          <div class="tab-pane fade show active" id="divbasic"><div id="basic-placeholder"></div></div>
          <div class="tab-pane fade" id="divobj"><div id="objectives-placeholder"></div></div>
          <div class="tab-pane fade" id="divsource"><div id="source-placeholder"></div></div>
          <div class="tab-pane fade" id="divassess"><div id="assess-placeholder"></div></div>
          <div class="tab-pane fade" id="divoutcome"><div id="outcome-placeholder"></div></div>
          <div class="tab-pane fade" id="divcontrib"><div id="contrib-placeholder"></div></div>
          <div class="tab-pane fade" id="divects"><div id="ects-placeholder"></div></div>
          <div class="tab-pane fade" id="divcontents"><div id="contents-placeholder"></div></div>
        </div>
      </div>
    </div>

    <!-- hidden input to store course code -->
    <!-- <input type="hidden" name="coursecode" id="coursecode" value=""> -->
  </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="tab.js"></script>
<script src="contrib.js"></script>
<script src="saveload.js"></script>
<script src="spinner.js"></script>
<script>
  async function loadCourse()
  {
    const urlParams = new URLSearchParams(window.location.search);
    const courseCode = urlParams.get('course');

    let data = {};

  if (courseCode) {
    try {
      const res = await fetch(`json/${courseCode}.json`);
      if (res.ok) {
        console.log(`Loading existing data from ${courseCode}.json`);
        data = await res.json();
      } else {
        console.warn(`JSON for ${courseCode} not found. Using empty form.`);
      }
    } catch (err) {
      console.error(`Error fetching ${courseCode}.json:`, err);
    }
  } else {
    console.log("No courseCode provided â€” opening fresh form.");
  }










  const loadTabContent = (id, file, callback) => {
      fetch(file)
          .then(res => res.text())
          .then(html => {
              document.getElementById(id).innerHTML = html;
              if (callback) callback();
          });
  };

  // Load all tabs
  loadTabContent('basic-placeholder', 'basic.html', () => {
      initSpinners();
      fetchAndPopulateJSON(data);
  });
  loadTabContent('objectives-placeholder', 'objectives.html', () => {
      const objectivesContainer = document.getElementById('objectivesContainer');
      const addBtn = document.getElementById('addObjectiveBtn');
      let objCount = 3;
      addBtn.addEventListener('click', () => {
          if (objCount >= 8) { addBtn.style.display = 'none'; return; }
          const div = document.createElement('div');
          div.classList.add('mb-3');
          const textarea = document.createElement('textarea');
          textarea.classList.add('form-control');
          textarea.id = `obj${objCount}`;
          textarea.name = `obj${objCount}`;
          textarea.placeholder = `Objective ${objCount + 1}`;
          textarea.rows = 2;
          div.appendChild(textarea);
          objectivesContainer.appendChild(div);
          objCount++;
          if (objCount >= 8) addBtn.style.display = 'none';
      });
      fetchAndPopulateJSON(data);
  });
  loadTabContent('source-placeholder', 'sources.html', () => {
    const sourcesContainer = document.getElementById('sourcesContainer');
    const addBtn = document.getElementById('addSourceBtn');
    let sourceCount = sourcesContainer.querySelectorAll('textarea').length;

    addBtn.addEventListener('click', () => {
        if (sourceCount >= 5) return;
        const div = document.createElement('div');
        div.classList.add('mb-3');
        const textarea = document.createElement('textarea');
        textarea.classList.add('form-control');
        textarea.id = `source${sourceCount}`;
        textarea.name = `source${sourceCount}`;
        textarea.placeholder = `Source ${sourceCount + 1}`;
        textarea.rows = 2;
        div.appendChild(textarea);
        sourcesContainer.appendChild(div);
        sourceCount++;
        if (sourceCount >= 5) addBtn.style.display = 'none';
    });

    fetchAndPopulateJSON(data);
});


loadTabContent('assess-placeholder', 'assess.html', () => {
    const assessContainer = document.getElementById('assessContainer');
    const addBtn = document.getElementById('addAssessmentBtn');
    let actCount = 4;

    addBtn.addEventListener('click', () => {
        if (actCount >= 8) { addBtn.style.display = 'none'; return; }

        const tr = document.createElement('tr');

        // First cell with text input
        const tdActivity = document.createElement('td');
        const inputActivity = document.createElement('input');
        inputActivity.type = 'text';
        inputActivity.name = `act${actCount}`;
        inputActivity.placeholder = `Activity ${actCount + 1}`;
        inputActivity.className = 'form-control form-control-sm border-0 p-1';
        tdActivity.appendChild(inputActivity);
        tr.appendChild(tdActivity);

        // Second cell with number input
        const tdPercent = document.createElement('td');
        const inputPercent = document.createElement('input');
        inputPercent.type = 'number';
        inputPercent.name = `actper${actCount}`;
        inputPercent.step = 1;
        inputPercent.min = 0;
        inputPercent.max = 100;
        inputPercent.className = 'form-control form-control-sm border-0 p-1 spinner-only';
        tdPercent.appendChild(inputPercent);
        tr.appendChild(tdPercent);

        assessContainer.appendChild(tr);

        actCount++;
        if (actCount >= 8) addBtn.style.display = 'none';
    });

    fetchAndPopulateJSON(data);
});

  // loadTabContent('assess-placeholder', 'assess.html', () => { fetchAndPopulateJSON(data); });
  loadTabContent('outcome-placeholder', 'outcome.html', () => {  fetchAndPopulateJSON(data); });
  loadTabContent('ects-placeholder', 'ects.html', () => {  fetchAndPopulateJSON(data); });
  loadTabContent('contents-placeholder', 'contents.html', () => {  fetchAndPopulateJSON(data); });
  loadTabContent('contrib-placeholder', 'contrib.html', () => {  fetchAndPopulateJSON(data); });
}

loadCourse();

  

</script>

</body>
</html>
